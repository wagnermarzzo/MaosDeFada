<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Michelly Pessoa Agendamentos</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:url("https://images.unsplash.com/photo-1604654894610-df63bc536371") no-repeat center center fixed;
    background-size:cover;
}

.container{
    background:rgba(255,255,255,0.96);
    max-width:500px;
    margin:40px auto;
    padding:25px;
    border-radius:15px;
}

h1{
    text-align:center;
    color:#d63384;
}

input, select{
    width:100%;
    padding:10px;
    margin:8px 0 15px 0;
    border-radius:8px;
    border:1px solid #ccc;
}

button{
    width:100%;
    padding:12px;
    background:#d63384;
    color:white;
    border:none;
    border-radius:10px;
    font-size:16px;
    cursor:pointer;
}

button:disabled{
    background:gray;
}
</style>
</head>

<body>

<div class="container">
<h1>ðŸ’… Michelly Pessoa Agendamentos</h1>

<form id="formAgendamento">

<input type="text" id="nome" placeholder="Nome" required>

<input type="date" id="data" required>

<select id="horario" required>
<option value="">Selecione o horÃ¡rio</option>
</select>

<select id="servico" required>
<option>MÃ£o e PÃ©</option>
<option>Pedicure</option>
<option>Manicure</option>
<option>Unha em Gel</option>
</select>

<button type="submit" id="btnAgendar">Agendar</button>

</form>
</div>

<!-- Firebase -->
<script type="module">
  // ðŸ”¹ Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, query, where, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // ðŸ”¹ Firebase config jÃ¡ com os dados do seu projeto
  const firebaseConfig = {
    apiKey: "AIzaSyDr30gr-1zVrkA9Vk3QTOc9-pzbGB0zDpE",
    authDomain: "maosdefada.firebaseapp.com",
    projectId: "maosdefada",
    storageBucket: "maosdefada.firebasestorage.app",
    messagingSenderId: "9299274038",
    appId: "1:9299274038:web:1617789c2ca2a08dfc6b97"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const inputData = document.getElementById("data");
  const selectHorario = document.getElementById("horario");
  const form = document.getElementById("formAgendamento");
  const btn = document.getElementById("btnAgendar");

  const horarios = {
    5:["18:00","20:00"], // sexta
    6:["07:00","09:00","11:00","14:00","17:00","19:00"] // sÃ¡bado
  };

  function formatarBR(dataISO){
      const [ano, mes, dia] = dataISO.split("-");
      return `${dia}/${mes}/${ano}`;
  }

  async function atualizarHorarios(){
      selectHorario.innerHTML = '<option value="">Selecione o horÃ¡rio</option>';
      if(!inputData.value) return;

      const diaSemana = new Date(inputData.value+"T00:00:00").getDay();
      const lista = horarios[diaSemana] || [];

      // ðŸ”’ Buscar horÃ¡rios jÃ¡ agendados no Firestore
      const q = query(collection(db, "agendamentos"), where("data","==",inputData.value));
      const snapshot = await getDocs(q);
      const ocupados = snapshot.docs.map(d => d.data().horario);

      lista.forEach(h => {
          if(!ocupados.includes(h)){
              const option = document.createElement("option");
              option.value = h;
              option.textContent = h;
              selectHorario.appendChild(option);
          }
      });
  }

  inputData.addEventListener("change", atualizarHorarios);

  form.addEventListener("submit", async (e)=>{
      e.preventDefault();

      if(btn.disabled) return;

      const nome = document.getElementById("nome").value.trim();
      const data = inputData.value;
      const horario = selectHorario.value;
      const servico = document.getElementById("servico").value;

      if(!nome || !data || !horario || !servico){
          alert("Preencha todos os campos!");
          return;
      }

      btn.disabled = true;
      btn.innerText = "Processando...";

      // ðŸ”’ Checar duplicidade no Firestore
      const q = query(collection(db,"agendamentos"), where("data","==",data), where("horario","==",horario));
      const snapshot = await getDocs(q);
      if(!snapshot.empty){
          alert("âš  Esse horÃ¡rio jÃ¡ foi agendado!");
          btn.disabled = false;
          btn.innerText = "Agendar";
          atualizarHorarios();
          return;
      }

      // ðŸ”¹ Inserir no Firestore
      await addDoc(collection(db,"agendamentos"),{
          nome,
          data,
          horario,
          servico,
          criadoEm: new Date()
      });

      atualizarHorarios();

      // ðŸ”¹ Enviar para WhatsApp
      const mensagem = `OlÃ¡ ðŸ’… Novo agendamento!\n\nNome: ${nome}\nData: ${formatarBR(data)}\nHorÃ¡rio: ${horario}\nServiÃ§o: ${servico}`;
      const numero = "5511964657571";
      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensagem)}`;
      window.location.href = url;

  });
</script>

</body>
</html>
