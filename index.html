<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Mãos De Fada - Agendamento</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI,sans-serif;}
body,html{height:100%;overflow:hidden;color:white;}

.slider{
position:fixed;
width:100%;
height:100%;
z-index:-2;
}
.slider img{
position:absolute;
width:100%;
height:100%;
object-fit:cover;
opacity:0;
transition:opacity 2s ease-in-out;
}
.slider img.active{opacity:1;}

.overlay{
position:fixed;
width:100%;
height:100%;
background:rgba(0,0,0,0.65);
z-index:-1;
}

.container{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
background:rgba(0,0,0,0.8);
padding:30px;
border-radius:20px;
width:90%;
max-width:400px;
box-shadow:0 0 30px gold;
}

h1{
text-align:center;
color:gold;
margin-bottom:15px;
}

input,select{
width:100%;
padding:10px;
margin:8px 0;
border:none;
border-radius:8px;
}

button{
width:100%;
padding:12px;
background:gold;
border:none;
border-radius:8px;
font-weight:bold;
cursor:pointer;
}
button:hover{background:#d4af37;}
</style>
</head>

<body>

<div class="slider">
<img src="https://images.unsplash.com/photo-1588776814546-1ffcf47267a5" class="active">
<img src="https://images.unsplash.com/photo-1604654894610-df63bc536371">
<img src="https://images.unsplash.com/photo-1589987607627-3c31f0d7f2b2">
</div>

<div class="overlay"></div>

<div class="container">
<h1>Mãos De Fada</h1>

<input type="text" id="nome" placeholder="Seu Nome" required>
<input type="text" id="telefone" placeholder="Telefone" required>
<input type="date" id="data" required>
<select id="horario"></select>

<select id="servico">
<option>Só Mão</option>
<option>Só Pé</option>
<option>Mão + Pé</option>
</select>

<button onclick="agendar()">Confirmar Agendamento</button>
</div>

<script>
const supabaseUrl = "https://mziwflpxhmslmrogdqlr.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im16aXdmbHB4aG1zbG1yb2dkcWxyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwNDc0ODgsImV4cCI6MjA4NjYyMzQ4OH0.jaXfxN6unS62oDAMlJI4sMhnEQzJ2waUI93f0w5MmYc";

const { createClient } = supabase;
const db = createClient(supabaseUrl, supabaseKey);

// SLIDE AUTOMÁTICO
let imagens = document.querySelectorAll(".slider img");
let index = 0;
setInterval(()=>{
imagens[index].classList.remove("active");
index = (index+1)%imagens.length;
imagens[index].classList.add("active");
},5000);

// HORÁRIOS INTELIGENTES
document.getElementById("data").addEventListener("change", async function(){
let dataSelecionada = this.value;
let dia = new Date(dataSelecionada).getDay();
let select = document.getElementById("horario");
select.innerHTML="";

let horarios = [];

if(dia>=1 && dia<=5){ horarios=["19:00"]; }
if(dia==6){ horarios=["08:00","10:00","14:00","16:00","18:00","20:00"]; }

for(let h of horarios){
let { data } = await db
.from("appointments")
.select("*")
.eq("data", dataSelecionada)
.eq("horario", h);

if(data.length==0){
let option=document.createElement("option");
option.value=h;
option.textContent=h;
select.appendChild(option);
}
}
});

// AGENDAR
async function agendar(){
let nome=document.getElementById("nome").value;
let telefone=document.getElementById("telefone").value;
let data=document.getElementById("data").value;
let horario=document.getElementById("horario").value;
let servico=document.getElementById("servico").value;

if(!nome || !telefone || !data || !horario){
alert("Preencha todos os campos!");
return;
}

let { error } = await db.from("appointments").insert([
{ nome, telefone, data, horario, servico }
]);

if(error){
alert("Horário já agendado!");
return;
}

let mensagem=`Novo agendamento Mãos De Fada\nNome: ${nome}\nData: ${data}\nHorário: ${horario}\nServiço: ${servico}`;
window.location.href=`https://wa.me/5511964657571?text=${encodeURIComponent(mensagem)}`;
}
</script>

</body>
  </html>
