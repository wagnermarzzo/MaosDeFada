<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MÃ£os De Fada</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin:0;
  font-family:'Poppins',sans-serif;
  overflow:hidden;
}

.slider {
  position:fixed;
  width:100%;
  height:100vh;
  background-size:cover;
  background-position:center;
  animation:slide 18s infinite;
}

@keyframes slide {
  0% {background-image:url('https://images.unsplash.com/photo-1588776814546-ec7e8f1f6a0f');}
  33% {background-image:url('https://images.unsplash.com/photo-1604654894610-df63bc536371');}
  66% {background-image:url('https://images.unsplash.com/photo-1596464716127-f2a82984de30');}
  100% {background-image:url('https://images.unsplash.com/photo-1588776814546-ec7e8f1f6a0f');}
}

.overlay {
  position:fixed;
  width:100%;
  height:100vh;
  background:rgba(255,255,255,0.85);
  display:flex;
  justify-content:center;
  align-items:center;
}

.container {
  background:white;
  padding:40px;
  border-radius:25px;
  box-shadow:0 15px 40px rgba(0,0,0,0.2);
  width:90%;
  max-width:400px;
  text-align:center;
}

h1 {
  color:#d81b60;
}

input, select {
  width:100%;
  padding:12px;
  margin:8px 0;
  border-radius:20px;
  border:1px solid #ddd;
}

button {
  width:100%;
  padding:14px;
  background:linear-gradient(45deg,#ec407a,#d81b60);
  border:none;
  color:white;
  font-weight:bold;
  border-radius:30px;
  cursor:pointer;
  margin-top:10px;
}

button:hover {
  transform:scale(1.05);
}
</style>
</head>

<body>

<div class="slider"></div>

<div class="overlay">
<div class="container">
<h1>MÃ£os De Fada ðŸ’…</h1>

<input type="text" id="nome" placeholder="Seu nome" required>
<input type="text" id="telefone" placeholder="Seu telefone" required>

<input type="date" id="data" required>
<select id="horario">
<option value="">Selecione o horÃ¡rio</option>
</select>

<select id="servico">
<option value="">Tipo de serviÃ§o</option>
<option value="SÃ³ MÃ£o">SÃ³ MÃ£o</option>
<option value="SÃ³ PÃ©">SÃ³ PÃ©</option>
<option value="MÃ£o e PÃ©">MÃ£o e PÃ©</option>
</select>

<button onclick="agendar()">Confirmar Agendamento</button>

</div>
</div>

<script>
const supabaseUrl = "https://mziwflpxhmslmrogdqlr.supabase.co";
const supabaseKey = "COLE_SUA_ANON_KEY_AQUI";
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

const dataInput = document.getElementById("data");
const horarioSelect = document.getElementById("horario");

dataInput.addEventListener("change", async () => {
  const dataSelecionada = dataInput.value;
  horarioSelect.innerHTML = '<option value="">Carregando...</option>';

  const { data } = await supabase
    .from("appointments")
    .select("horario")
    .eq("data", dataSelecionada);

  const ocupados = data.map(item => item.horario);

  const diaSemana = new Date(dataSelecionada).getDay();
  let horarios = [];

  if (diaSemana >= 1 && diaSemana <= 5) {
    horarios = ["19:00"];
  }

  if (diaSemana === 6) {
    horarios = ["08:00","10:00","14:00","16:00","18:00","20:00"];
  }

  const disponiveis = horarios.filter(h => !ocupados.includes(h));

  horarioSelect.innerHTML = '<option value="">Selecione o horÃ¡rio</option>';

  disponiveis.forEach(h => {
    const option = document.createElement("option");
    option.value = h;
    option.textContent = h;
    horarioSelect.appendChild(option);
  });
});

async function agendar() {

  const nome = document.getElementById("nome").value;
  const telefone = document.getElementById("telefone").value;
  const data = dataInput.value;
  const horario = horarioSelect.value;
  const servico = document.getElementById("servico").value;

  if(!nome || !telefone || !data || !horario || !servico){
    alert("Preencha todos os campos!");
    return;
  }

  const { error } = await supabase
    .from("appointments")
    .insert([{ nome, telefone, data, horario, servico }]);

  if(error){
    alert("Erro ao agendar. Tente novamente.");
    return;
  }

  const mensagem =
`OlÃ¡! Novo agendamento ðŸ’…

Nome: ${nome}
Telefone: ${telefone}
Data: ${data}
HorÃ¡rio: ${horario}
ServiÃ§o: ${servico}`;

  const url = `https://wa.me/5511964657571?text=${encodeURIComponent(mensagem)}`;
  window.open(url, "_blank");

  alert("Agendamento confirmado!");
}
</script>

</body>
</html>
